<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>PasserGen - Secure Password Generator</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <style>
       @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
       body {
           font-family: 'Inter', sans-serif;
           background-color: #f3f4f6;
       }
       .strength-bar {
           transition: width 0.3s ease-in-out;
       }
       .captcha-grid {
           display: grid;
           grid-template-columns: repeat(3, 1fr);
           gap: 0.5rem;
       }
       .captcha-tile {
           aspect-ratio: 1 / 1;
           display: flex;
           align-items: center;
           justify-content: center;
           background-color: #e5e7eb;
           border-radius: 0.5rem;
           cursor: pointer;
           transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
           font-size: 2rem;
       }
       .captcha-tile:hover {
           transform: scale(1.05);
       }
       .captcha-tile.selected {
           outline: 3px solid #3b82f6;
           outline-offset: -3px;
       }
   </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
   <div class="bg-white p-8 rounded-2xl shadow-xl max-w-lg w-full m-4 relative">
       <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">PasserGen</h1>


       <button id="captcha-corner-btn" class="absolute top-4 right-4 p-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400">
           <span class="text-2xl" role="img" aria-label="CAPTCHA puzzle icon">🧩</span>
       </button>


       <div class="flex justify-center mb-6 border-b border-gray-200">
           <button id="tab-generate-password" class="px-4 py-2 text-sm font-semibold text-gray-700 hover:text-blue-600 focus:outline-none border-b-2 border-transparent hover:border-blue-600 transition-colors duration-200">Generate Password</button>
           <button id="tab-test-password" class="px-4 py-2 text-sm font-semibold text-gray-700 hover:text-blue-600 focus:outline-none border-b-2 border-transparent hover:border-blue-600 transition-colors duration-200">Test Your Password</button>
           <button id="tab-generate-passphrase" class="px-4 py-2 text-sm font-semibold text-gray-700 hover:text-blue-600 focus:outline-none border-b-2 border-transparent hover:border-blue-600 transition-colors duration-200">Generate Passphrase</button>
       </div>


       <div id="section-generate-password" class="tab-content">
           <div class="relative flex items-center bg-gray-200 rounded-lg p-3 mb-6">
               <input id="password-output" type="text" readonly class="bg-transparent flex-grow text-gray-700 font-mono text-lg outline-none cursor-text select-all" value="Click 'Generate'">
               <button id="copy-btn-password" class="ml-4 p-2 bg-gray-300 hover:bg-gray-400 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500">
                   <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 4l3 3m0 0l-3 3m3-3h8a2 2 0 002-2v-2m-3-1l3 3m0 0l-3 3"/>
                   </svg>
               </button>
           </div>


           <div class="mb-6">
               <div class="flex justify-between items-center mb-2">
                   <label for="length-slider" class="text-gray-700">Password Length:</label>
                   <span id="length-value" class="font-bold text-gray-800">12</span>
               </div>
               <input type="range" id="length-slider" min="8" max="24" value="12" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer">
           </div>


           <div class="space-y-4 mb-6">
               <p class="text-gray-700 font-medium">Use a custom character set:</p>
               <textarea id="custom-char-set" rows="2" class="w-full p-2 rounded-lg border border-gray-300 text-gray-700" placeholder="e.g., abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%"></textarea>
               <label class="flex items-center space-x-3 text-gray-700">
                   <input type="checkbox" id="exclude-ambiguous" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                   <span>Exclude Ambiguous Characters (l, 1, I, O, 0)</span>
               </label>
           </div>


           <button id="generate-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md transition-colors duration-200">Generate Password</button>
       </div>


       <div id="section-test-password" class="tab-content hidden">
           <p class="text-gray-700 mb-2">Enter your password to test its strength:</p>
           <input type="text" id="test-password-input" class="w-full bg-gray-200 rounded-lg p-3 text-gray-700 font-mono text-lg outline-none mb-4">
          
           <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
               <p class="font-bold text-gray-800 mb-2">Analysis:</p>
               <div class="mb-4">
                   <p class="text-gray-700 mb-2">Password Strength:</p>
                   <div class="bg-gray-300 h-2 rounded-lg">
                       <div id="strength-bar" class="strength-bar h-2 rounded-lg" style="width: 0%;"></div>
                   </div>
                   <p id="strength-text" class="text-center font-semibold mt-2 text-gray-600">--</p>
               </div>


               <div class="mb-4">
                   <p class="text-gray-700 mb-2">Entropy:</p>
                   <p id="entropy-display" class="text-center font-semibold text-gray-800">Calculating...</p>
               </div>


               <div class="mb-4">
                   <p class="text-gray-700 mb-2">Estimated Crack Time:</p>
                   <p id="crack-time-display" class="text-center font-semibold text-gray-800">Calculating...</p>
               </div>


               <div class="mb-2">
                   <p class="text-gray-700 mb-2">Pwned Password Check:</p>
                   <div id="pwned-status" class="text-center font-semibold p-2 rounded-lg">Checking...</div>
               </div>


               <div id="strength-tips">
                   <p class="font-bold text-gray-800 mb-2">Security Tips:</p>
                   <ul id="tips-list" class="text-gray-700 text-sm space-y-2">
                       </ul>
               </div>
           </div>
       </div>


       <div id="section-generate-passphrase" class="tab-content hidden">
           <div class="relative flex items-center bg-gray-200 rounded-lg p-3 mb-6">
               <input id="passphrase-output" type="text" readonly class="bg-transparent flex-grow text-gray-700 font-mono text-lg outline-none cursor-text select-all" value="Click 'Generate'">
               <button id="copy-btn-passphrase" class="ml-4 p-2 bg-gray-300 hover:bg-gray-400 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500">
                   <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 4l3 3m0 0l-3 3m3-3h8a2 2 0 002-2v-2m-3-1l3 3m0 0l-3 3"/>
                   </svg>
               </button>
           </div>
           <div class="mb-6">
               <div class="flex justify-between items-center mb-2">
                   <label for="passphrase-length" class="text-gray-700">Number of words:</label>
                   <span id="passphrase-length-value" class="font-bold text-gray-800">4</span>
               </div>
               <input type="range" id="passphrase-length-slider" min="3" max="8" value="4" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer">
           </div>


           <div class="space-y-4 mb-6">
               <label class="flex items-center space-x-3 text-gray-700">
                   <span>Separator:</span>
                   <select id="passphrase-separator" class="form-select bg-gray-200 rounded-lg p-2 text-gray-700">
                       <option value="-">- (Hyphen)</option>
                       <option value="_">_ (Underscore)</option>
                       <option value=" "> (Space)</option>
                   </select>
               </label>
               <label class="flex items-center space-x-3 text-gray-700">
                   <input type="checkbox" id="capitalize-words" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                   <span>Capitalize First Letter</span>
               </label>
           </div>


           <div class="mb-6">
               <label class="flex items-center space-x-3 text-gray-700 mb-2">
                   <input type="checkbox" id="use-custom-words" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                   <span>Use My Own Words</span>
               </label>
               <textarea id="custom-word-input" rows="3" class="w-full p-2 rounded-lg border border-gray-300 text-gray-700" placeholder="Enter your words, separated by a comma or space." disabled></textarea>
           </div>


           <button id="generate-passphrase-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md transition-colors duration-200">Generate Passphrase</button>
       </div>
    
       <div id="section-captcha-practice" class="tab-content hidden">
           <h2 id="captcha-instruction" class="text-lg font-bold text-gray-800 mb-4 text-center"></h2>
           <div id="captcha-grid" class="captcha-grid mb-6">
               </div>
           <button id="verify-captcha-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md transition-colors duration-200">Verify</button>
           <p id="captcha-message" class="text-center font-semibold mt-4"></p>
       </div>


       <div class="mt-8 pt-4 border-t border-gray-200">
           <div class="flex justify-between items-center mb-4">
               <h2 class="text-lg font-bold text-gray-800">Recent History</h2>
               <button id="clear-history-btn" class="text-sm text-red-500 hover:text-red-700 transition-colors duration-200">Clear History</button>
           </div>
           <ul id="history-list" class="space-y-2">
               <li class="text-gray-500 text-sm">No history yet.</li>
           </ul>
       </div>
    
       <div class="mt-8 p-4 bg-yellow-100 rounded-xl border-l-4 border-yellow-500 text-yellow-800">
           <p class="font-bold">Important Security Tip:</p>
           <p class="text-sm mt-2">The best way to protect your accounts is to enable **Multi-Factor Authentication (MFA)**. This adds a second layer of security, like a code from your phone, to prevent unauthorized access even if your password ismen is stolen.</p>
       </div>


       <div id="message-box" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
           <div class="bg-white p-6 rounded-lg shadow-xl text-center">
               <p id="message-text" class="text-gray-800 font-semibold mb-4"></p>
               <button id="close-message" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">OK</button>
           </div>
       </div>
   </div>


   <script>
       document.addEventListener('DOMContentLoaded', () => {
           const lengthSlider = document.getElementById('length-slider');
           const lengthValue = document.getElementById('length-value');
           const passwordOutput = document.getElementById('password-output');
           const generateBtn = document.getElementById('generate-btn');
           const copyBtnPassword = document.getElementById('copy-btn-password');
           const customCharSetInput = document.getElementById('custom-char-set');
           const excludeAmbiguousCheckbox = document.getElementById('exclude-ambiguous');


           const strengthBar = document.getElementById('strength-bar');
           const strengthText = document.getElementById('strength-text');
           const entropyDisplay = document.getElementById('entropy-display');
           const testPasswordInput = document.getElementById('test-password-input');
           const strengthTipsList = document.getElementById('tips-list');
           const crackTimeDisplay = document.getElementById('crack-time-display');
           const pwnedStatus = document.getElementById('pwned-status');


           const passphraseOutput = document.getElementById('passphrase-output');
           const passphraseLengthSlider = document.getElementById('passphrase-length-slider');
           const passphraseLengthValue = document.getElementById('passphrase-length-value');
           const passphraseSeparator = document.getElementById('passphrase-separator');
           const capitalizeWords = document.getElementById('capitalize-words');
           const generatePassphraseBtn = document.getElementById('generate-passphrase-btn');
           const copyBtnPassphrase = document.getElementById('copy-btn-passphrase');
           const useCustomWordsCheckbox = document.getElementById('use-custom-words');
           const customWordInput = document.getElementById('custom-word-input');


           const captchaCornerBtn = document.getElementById('captcha-corner-btn');
           const captchaInstruction = document.getElementById('captcha-instruction');
           const captchaGrid = document.getElementById('captcha-grid');
           const verifyCaptchaBtn = document.getElementById('verify-captcha-btn');
           const captchaMessage = document.getElementById('captcha-message');


           const historyList = document.getElementById('history-list');
           const clearHistoryBtn = document.getElementById('clear-history-btn');


           const tabs = {
               'tab-generate-password': 'section-generate-password',
               'tab-test-password': 'section-test-password',
               'tab-generate-passphrase': 'section-generate-passphrase',
               'captcha-corner-btn': 'section-captcha-practice'
           };


           const messageBox = document.getElementById('message-box');
           const messageText = document.getElementById('message-text');
           const closeMessageBtn = document.getElementById('close-message');


           const ambiguous = 'l1IO0';
           const defaultWords = [
               "apple", "banana", "cat", "dog", "elephant", "fish", "guitar", "house", "ice", "jungle",
               "kite", "lemon", "mountain", "notebook", "ocean", "pizza", "queen", "robot", "sunshine", "tree",
               "umbrella", "violin", "whale", "xray", "yellow", "zebra", "happy", "brave", "quiet", "strong", "manzana",
               "pollo", "extrana", "cuarenta", "fria", "phoenix", "colgate", "french", "fry", "galaxy"
           ];
          
           const CAPTCHA_EMOJIS = ['🐶', '🐱', '🐭', '🐹', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯', '🦁', '🐮', '🐷', '🐸', '🐵', '🐔', '🐧', '🐦', '🦉'];
           //
           let currentCaptchaChallenge = { emoji: null, correctTiles: [] };


           const HISTORY_MAX_SIZE = 5;


           const showMessage = (text) => {
               messageText.textContent = text;
               messageBox.classList.remove('hidden');
           };


           closeMessageBtn.addEventListener('click', () => {
               messageBox.classList.add('hidden');
           });


           const getHistory = () => {
               try {
                   const history = JSON.parse(localStorage.getItem('passwordHistory')) || [];
                   return history;
               } catch (e) {
                   console.error("Could not load history from localStorage:", e);
                   return [];
               }
           };


           const saveToHistory = (entry) => {
               let history = getHistory();
               history.unshift(entry);
               if (history.length > HISTORY_MAX_SIZE) {
                   history = history.slice(0, HISTORY_MAX_SIZE);
               }
               localStorage.setItem('passwordHistory', JSON.stringify(history));
               displayHistory();
           };


           const clearHistory = () => {
               localStorage.removeItem('passwordHistory');
               displayHistory();
           };


           const displayHistory = () => {
               const history = getHistory();
               historyList.innerHTML = '';
               if (history.length === 0) {
                   historyList.innerHTML = '<li class="text-gray-500 text-sm">No history yet.</li>';
                   return;
               }


               history.forEach(item => {
                   const li = document.createElement('li');
                   li.classList.add('flex', 'justify-between', 'items-center', 'py-1', 'px-2', 'bg-gray-100', 'rounded-lg');
                  
                   const span = document.createElement('span');
                   span.classList.add('font-mono', 'text-gray-700', 'text-sm', 'truncate', 'cursor-pointer');
                   span.textContent = item;
                   span.title = item;
                  
                   const copyBtn = document.createElement('button');
                   copyBtn.classList.add('ml-2', 'text-gray-500', 'hover:text-blue-600');
                   copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 4l3 3m0 0l-3 3m3-3h8a2 2 0 002-2v-2m-3-1l3 3m0 0l-3 3"/></svg>';
                   copyBtn.addEventListener('click', () => {
                       navigator.clipboard.writeText(item).then(() => {
                           showMessage('Copied to clipboard!');
                       }).catch(err => {
                           console.error('Failed to copy text:', err);
                           showMessage('Failed to copy. Please try again.');
                       });
                   });


                   li.appendChild(span);
                   li.appendChild(copyBtn);
                   historyList.appendChild(li);
               });
           };


           clearHistoryBtn.addEventListener('click', clearHistory);
          
           document.querySelectorAll('button[id^="tab-"], button#captcha-corner-btn').forEach(tab => {
               tab.addEventListener('click', () => {
                   document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                   document.querySelectorAll('button[id^="tab-"]').forEach(t => t.classList.remove('border-blue-600'));
                  
                   const sectionId = tabs[tab.id];
                   document.getElementById(sectionId).classList.remove('hidden');
                  
                   if (tab.id.startsWith('tab-')) {
                       tab.classList.add('border-blue-600');
                   }


                   if (sectionId === 'section-captcha-practice') {
                       generateCaptcha();
                   } else {
                       updateStrength('');
                   }
               });
           });


           lengthSlider.addEventListener('input', () => {
               lengthValue.textContent = lengthSlider.value;
           });


           lengthSlider.addEventListener('change', generatePassword);
           customCharSetInput.addEventListener('input', generatePassword);
           excludeAmbiguousCheckbox.addEventListener('change', generatePassword);


           generateBtn.addEventListener('click', () => {
               const newPassword = generatePassword();
               saveToHistory(newPassword);
           });
          
           copyBtnPassword.addEventListener('click', () => {
               if (passwordOutput.value && passwordOutput.value !== "Click 'Generate'") {
                   navigator.clipboard.writeText(passwordOutput.value).then(() => {
                       showMessage('Password copied to clipboard!');
                   }).catch(err => {
                       console.error('Failed to copy text:', err);
                       showMessage('Failed to copy. Please try again.');
                   });
               } else {
                   showMessage('No password to copy.');
               }
           });


           function generatePassword() {
               const length = lengthSlider.value;
               let characterSet = customCharSetInput.value.trim();


               if (characterSet.length === 0) {
                   characterSet = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:",./<>?`~';
                   customCharSetInput.value = characterSet;
               }
              
               if (excludeAmbiguousCheckbox.checked) {
                   characterSet = characterSet.split('').filter(char => !ambiguous.includes(char)).join('');
               }


               if (characterSet.length === 0) {
                   passwordOutput.value = '';
                   updateStrength('');
                   return '';
               }


               let password = '';
               for (let i = 0; i < length; i++) {
                   const randomIndex = Math.floor(Math.random() * characterSet.length);
                   password += characterSet[randomIndex];
               }
               passwordOutput.value = password;
               updateStrength(password);
               return password;
           }


           testPasswordInput.addEventListener('input', () => {
               const password = testPasswordInput.value;
               updateStrength(password);
               displayStrengthTips(password);
               checkPwnedPassword(password);
           });


           passphraseLengthSlider.addEventListener('input', () => {
               passphraseLengthValue.textContent = passphraseLengthSlider.value;
           });


           useCustomWordsCheckbox.addEventListener('change', () => {
               customWordInput.disabled = !useCustomWordsCheckbox.checked;
               if (useCustomWordsCheckbox.checked) {
                   customWordInput.focus();
               }
           });


           [passphraseLengthSlider, passphraseSeparator, capitalizeWords, useCustomWordsCheckbox, customWordInput].forEach(elem => {
               elem.addEventListener('input', () => {
                   generatePassphrase();
               });
           });
          
           generatePassphraseBtn.addEventListener('click', () => {
               const newPassphrase = generatePassphrase();
               saveToHistory(newPassphrase);
           });


           copyBtnPassphrase.addEventListener('click', () => {
               if (passphraseOutput.value && passphraseOutput.value !== "Click 'Generate'") {
                   navigator.clipboard.writeText(passphraseOutput.value).then(() => {
                       showMessage('Passphrase copied to clipboard!');
                   }).catch(err => {
                       console.error('Failed to copy text:', err);
                       showMessage('Failed to copy. Please try again.');
                   });
               } else {
                   showMessage('No passphrase to copy.');
               }
           });
          
           function generatePassphrase() {
               const numWords = passphraseLengthSlider.value;
               const separator = passphraseSeparator.value;
               const shouldCapitalize = capitalizeWords.checked;


               let wordList;
               if (useCustomWordsCheckbox.checked) {
                   const customWords = customWordInput.value.split(/[\s,]+/).filter(word => word.length > 0);
                   if (customWords.length === 0) {
                       showMessage('Please enter at least one custom word.');
                       passphraseOutput.value = '';
                       return '';
                   }
                   wordList = customWords;
               } else {
                   wordList = defaultWords;
               }


               let passphrase = [];
               for (let i = 0; i < numWords; i++) {
                   const randomIndex = Math.floor(Math.random() * wordList.length);
                   let word = wordList[randomIndex];
                   if (shouldCapitalize) {
                       word = word.charAt(0).toUpperCase() + word.slice(1);
                   }
                   passphrase.push(word);
               }
               const result = passphrase.join(separator);
               passphraseOutput.value = result;
               updateStrength(result);
               return result;
           }


           function updateStrength(password) {
               if (password === '') {
                   strengthBar.style.width = '0%';
                   strengthBar.style.backgroundColor = 'transparent';
                   strengthText.textContent = '--';
                   entropyDisplay.textContent = '--';
                   crackTimeDisplay.textContent = 'Calculating...';
                   return;
               }
              
               let entropy;
               const activeTabId = document.querySelector('.tab-content:not(.hidden)').id;
               const isPassphrase = activeTabId === 'section-generate-passphrase' || testPasswordInput.value.includes(' ');
              
               if (isPassphrase) {
                   const words = password.split(/[\s_-]/).filter(w => w.length > 0);
                   const wordListSize = useCustomWordsCheckbox.checked ? customWordInput.value.split(/[\s,]+/).filter(w => w.length > 0).length : defaultWords.length;
                   if (words.length === 0 || wordListSize === 0) {
                       entropy = 0;
                   } else {
                       entropy = words.length * Math.log2(wordListSize);
                   }
               } else {
                   const charPoolSize = getCharacterSetSize(password);
                   entropy = calculateEntropy(charPoolSize, password.length);
               }
              
               entropyDisplay.textContent = `${entropy.toFixed(2)} bits`;


               let strength = '';
               let color = '';
               let width = 0;


               if (entropy > 128) {
                   strength = 'Very Strong';
                   color = '#22c55e';
                   width = 100;
               } else if (entropy > 80) {
                   strength = 'Strong';
                   color = '#84cc16';
                   width = 80;
               } else if (entropy > 60) {
                   strength = 'Medium';
                   color = '#eab308';
                   width = 60;
               } else if (entropy > 40) {
                   strength = 'Weak';
                   color = '#f97316';
                   width = 40;
               } else {
                   strength = 'Very Weak';
                   color = '#ef4444';
                   width = 20;
               }


               strengthBar.style.width = width + '%';
               strengthBar.style.backgroundColor = color;
               strengthText.textContent = strength;
              
               calculateCrackTime(password, isPassphrase, entropy);
           }


           function calculateEntropy(poolSize, length) {
               if (poolSize === 0 || length === 0) return 0;
               return length * Math.log2(poolSize);
           }
          
           function calculateCrackTime(password, isPassphrase, entropy) {
               // Using a more realistic (and variable) guesses per second
               const guessesPerSecond = 100000000000;
               const secondsToCrack = Math.pow(2, entropy) / guessesPerSecond;
              
               crackTimeDisplay.textContent = formatTime(secondsToCrack);
           }


           function getCharacterSetSize(password) {
               let size = 0;
               if (/[A-Z]/.test(password)) size += 26;
               if (/[a-z]/.test(password)) size += 26;
               if (/[0-9]/.test(password)) size += 10;
               if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(password)) size += 32;
               return size;
           }


           function formatTime(seconds) {
               if (seconds < 1) return `Less than 1 second`;
               if (seconds < 60) return `${Math.round(seconds)} seconds`;
               const minutes = seconds / 60;
               if (minutes < 60) return `${Math.round(minutes)} minutes`;
               const hours = minutes / 60;
               if (hours < 24) return `${Math.round(hours)} hours`;
               const days = hours / 24;
               if (days < 365) return `${Math.round(days)} days`;
               const years = days / 365.25;
               if (years < 1000) return `${years.toFixed(1)} years`;
               return 'Over 1000 years';
           }


           function displayStrengthTips(password) {
               strengthTipsList.innerHTML = '';
               const tips = [];
               const hasUppercase = /[A-Z]/.test(password);
               const hasLowercase = /[a-z]/.test(password);
               const hasNumbers = /[0-9]/.test(password);
               const hasSymbols = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(password);
               const isPassphrase = password.includes(' ');


               if (password.length < 12) {
                   tips.push('Increase password length. Longer passwords are much harder to crack.');
               }
               if (!hasUppercase) {
                   tips.push('Include uppercase letters (A-Z) for more complexity.');
               }
               if (!hasLowercase) {
                   tips.push('Include lowercase letters (a-z) for more complexity.');
               }
               if (!hasNumbers) {
                   tips.push('Add numbers (0-9) to your password.');
               }
               if (!hasSymbols) {
                   tips.push('Add special characters or symbols (!, @, #, etc.).');
               }
               if (isPassphrase && password.length > 20) {
                   tips.push('Passphrases are a great way to create a strong, memorable password.');
               }
              
               if (tips.length === 0) {
                   tips.push('Looks great! Your password is strong and secure.');
               }


               tips.forEach(tip => {
                   const li = document.createElement('li');
                   li.textContent = '➡️ ' + tip;
                   strengthTipsList.appendChild(li);
               });
           }


           // Mocking the Pwned Passwords API check
           async function checkPwnedPassword(password) {
               if (password.length === 0) {
                   pwnedStatus.textContent = 'Enter a password to check';
                   pwnedStatus.className = 'text-center font-semibold p-2 rounded-lg';
                   return;
               }
              
               pwnedStatus.textContent = 'Checking...';
               pwnedStatus.className = 'text-center font-semibold p-2 rounded-lg text-gray-700 bg-gray-200';
              
               // This is a mock response, a real implementation would use a service like Have I Been Pwned API
               const pwnedPasswords = ['password123', '123456', 'qwerty', 'admin'];
               await new Promise(r => setTimeout(r, 1000)); // Simulate API delay
              
               const isPwned = pwnedPasswords.includes(password.toLowerCase());


               if (isPwned) {
                   pwnedStatus.textContent = 'This password has been found in a data breach. DO NOT USE IT.';
                   pwnedStatus.className = 'text-center font-semibold p-2 rounded-lg text-white bg-red-500';
               } else {
                   pwnedStatus.textContent = 'Great! Your password was not found in a public data breach.';
                   pwnedStatus.className = 'text-center font-semibold p-2 rounded-lg text-white bg-green-500';
               }
           }


           // CAPTCHA functionality
           function generateCaptcha() {
               captchaGrid.innerHTML = '';
               captchaMessage.textContent = '';
               const challengeEmoji = CAPTCHA_EMOJIS[Math.floor(Math.random() * CAPTCHA_EMOJIS.length)];
               captchaInstruction.textContent = `Select all tiles containing the ${challengeEmoji} emoji.`;


               const allEmojis = [...CAPTCHA_EMOJIS];
               const gridEmojis = [];
               for (let i = 0; i < 9; i++) {
                   const randomEmoji = allEmojis[Math.floor(Math.random() * allEmojis.length)];
                   gridEmojis.push(randomEmoji);
               }


               currentCaptchaChallenge.emoji = challengeEmoji;
               currentCaptchaChallenge.correctTiles = [];


               gridEmojis.forEach((emoji, index) => {
                   const tile = document.createElement('div');
                   tile.classList.add('captcha-tile');
                   tile.textContent = emoji;
                   tile.dataset.index = index;
                   if (emoji === challengeEmoji) {
                       currentCaptchaChallenge.correctTiles.push(index);
                   }
                   tile.addEventListener('click', () => {
                       tile.classList.toggle('selected');
                   });
                   captchaGrid.appendChild(tile);
               });
           }


           verifyCaptchaBtn.addEventListener('click', () => {
               const selectedTiles = document.querySelectorAll('.captcha-tile.selected');
               const selectedIndices = Array.from(selectedTiles).map(tile => parseInt(tile.dataset.index));
              
               const isCorrect = selectedIndices.length === currentCaptchaChallenge.correctTiles.length &&
                                 selectedIndices.every(index => currentCaptchaChallenge.correctTiles.includes(index));


               if (isCorrect) {
                   captchaMessage.textContent = 'Verification successful';
                   captchaMessage.className = 'text-center font-semibold mt-4 text-green-600';
               } else {
                   captchaMessage.textContent = 'Verification failed. Please try again.';
                   captchaMessage.className = 'text-center font-semibold mt-4 text-red-600';
                   generateCaptcha();
               }
           });


           // Initialize on page load
           displayHistory();
           document.getElementById('tab-generate-password').click();
       });
   </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>PasserGen - Secure Password Generator</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <style>
       @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
       body {
           font-family: 'Inter', sans-serif;
           background-color: #f3f4f6;
       }
       .strength-bar {
           transition: width 0.3s ease-in-out;
       }
       .captcha-grid {
           display: grid;
           grid-template-columns: repeat(3, 1fr);
           gap: 0.5rem;
       }
       .captcha-tile {
           aspect-ratio: 1 / 1;
           display: flex;
           align-items: center;
           justify-content: center;
           background-color: #e5e7eb;
           border-radius: 0.5rem;
           cursor: pointer;
           transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
           font-size: 2rem;
       }
       .captcha-tile:hover {
           transform: scale(1.05);
       }
       .captcha-tile.selected {
           outline: 3px solid #3b82f6;
           outline-offset: -3px;
       }
   </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
   <div class="bg-white p-8 rounded-2xl shadow-xl max-w-lg w-full m-4 relative">
       <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">PasserGen</h1>


       <button id="captcha-corner-btn" class="absolute top-4 right-4 p-2 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-400">
           <span class="text-2xl" role="img" aria-label="CAPTCHA puzzle icon">🧩</span>
       </button>


       <div class="flex justify-center mb-6 border-b border-gray-200">
           <button id="tab-generate-password" class="px-4 py-2 text-sm font-semibold text-gray-700 hover:text-blue-600 focus:outline-none border-b-2 border-transparent hover:border-blue-600 transition-colors duration-200">Generate Password</button>
           <button id="tab-test-password" class="px-4 py-2 text-sm font-semibold text-gray-700 hover:text-blue-600 focus:outline-none border-b-2 border-transparent hover:border-blue-600 transition-colors duration-200">Test Your Password</button>
           <button id="tab-generate-passphrase" class="px-4 py-2 text-sm font-semibold text-gray-700 hover:text-blue-600 focus:outline-none border-b-2 border-transparent hover:border-blue-600 transition-colors duration-200">Generate Passphrase</button>
       </div>


       <div id="section-generate-password" class="tab-content">
           <div class="relative flex items-center bg-gray-200 rounded-lg p-3 mb-6">
               <input id="password-output" type="text" readonly class="bg-transparent flex-grow text-gray-700 font-mono text-lg outline-none cursor-text select-all" value="Click 'Generate'">
               <button id="copy-btn-password" class="ml-4 p-2 bg-gray-300 hover:bg-gray-400 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500">
                   <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 4l3 3m0 0l-3 3m3-3h8a2 2 0 002-2v-2m-3-1l3 3m0 0l-3 3"/>
                   </svg>
               </button>
           </div>


           <div class="mb-6">
               <div class="flex justify-between items-center mb-2">
                   <label for="length-slider" class="text-gray-700">Password Length:</label>
                   <span id="length-value" class="font-bold text-gray-800">12</span>
               </div>
               <input type="range" id="length-slider" min="8" max="24" value="12" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer">
           </div>


           <div class="space-y-4 mb-6">
               <p class="text-gray-700 font-medium">Use a custom character set:</p>
               <textarea id="custom-char-set" rows="2" class="w-full p-2 rounded-lg border border-gray-300 text-gray-700" placeholder="e.g., abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%"></textarea>
               <label class="flex items-center space-x-3 text-gray-700">
                   <input type="checkbox" id="exclude-ambiguous" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                   <span>Exclude Ambiguous Characters (l, 1, I, O, 0)</span>
               </label>
           </div>


           <button id="generate-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md transition-colors duration-200">Generate Password</button>
       </div>


       <div id="section-test-password" class="tab-content hidden">
           <p class="text-gray-700 mb-2">Enter your password to test its strength:</p>
           <input type="text" id="test-password-input" class="w-full bg-gray-200 rounded-lg p-3 text-gray-700 font-mono text-lg outline-none mb-4">
          
           <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
               <p class="font-bold text-gray-800 mb-2">Analysis:</p>
               <div class="mb-4">
                   <p class="text-gray-700 mb-2">Password Strength:</p>
                   <div class="bg-gray-300 h-2 rounded-lg">
                       <div id="strength-bar" class="strength-bar h-2 rounded-lg" style="width: 0%;"></div>
                   </div>
                   <p id="strength-text" class="text-center font-semibold mt-2 text-gray-600">--</p>
               </div>


               <div class="mb-4">
                   <p class="text-gray-700 mb-2">Entropy:</p>
                   <p id="entropy-display" class="text-center font-semibold text-gray-800">Calculating...</p>
               </div>


               <div class="mb-4">
                   <p class="text-gray-700 mb-2">Estimated Crack Time:</p>
                   <p id="crack-time-display" class="text-center font-semibold text-gray-800">Calculating...</p>
               </div>


               <div class="mb-2">
                   <p class="text-gray-700 mb-2">Pwned Password Check:</p>
                   <div id="pwned-status" class="text-center font-semibold p-2 rounded-lg">Checking...</div>
               </div>


               <div id="strength-tips">
                   <p class="font-bold text-gray-800 mb-2">Security Tips:</p>
                   <ul id="tips-list" class="text-gray-700 text-sm space-y-2">
                       </ul>
               </div>
           </div>
       </div>


       <div id="section-generate-passphrase" class="tab-content hidden">
           <div class="relative flex items-center bg-gray-200 rounded-lg p-3 mb-6">
               <input id="passphrase-output" type="text" readonly class="bg-transparent flex-grow text-gray-700 font-mono text-lg outline-none cursor-text select-all" value="Click 'Generate'">
               <button id="copy-btn-passphrase" class="ml-4 p-2 bg-gray-300 hover:bg-gray-400 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500">
                   <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 4l3 3m0 0l-3 3m3-3h8a2 2 0 002-2v-2m-3-1l3 3m0 0l-3 3"/>
                   </svg>
               </button>
           </div>
           <div class="mb-6">
               <div class="flex justify-between items-center mb-2">
                   <label for="passphrase-length" class="text-gray-700">Number of words:</label>
                   <span id="passphrase-length-value" class="font-bold text-gray-800">4</span>
               </div>
               <input type="range" id="passphrase-length-slider" min="3" max="8" value="4" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer">
           </div>


           <div class="space-y-4 mb-6">
               <label class="flex items-center space-x-3 text-gray-700">
                   <span>Separator:</span>
                   <select id="passphrase-separator" class="form-select bg-gray-200 rounded-lg p-2 text-gray-700">
                       <option value="-">- (Hyphen)</option>
                       <option value="_">_ (Underscore)</option>
                       <option value=" "> (Space)</option>
                   </select>
               </label>
               <label class="flex items-center space-x-3 text-gray-700">
                   <input type="checkbox" id="capitalize-words" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                   <span>Capitalize First Letter</span>
               </label>
           </div>


           <div class="mb-6">
               <label class="flex items-center space-x-3 text-gray-700 mb-2">
                   <input type="checkbox" id="use-custom-words" class="form-checkbox h-5 w-5 text-blue-600 rounded">
                   <span>Use My Own Words</span>
               </label>
               <textarea id="custom-word-input" rows="3" class="w-full p-2 rounded-lg border border-gray-300 text-gray-700" placeholder="Enter your words, separated by a comma or space." disabled></textarea>
           </div>


           <button id="generate-passphrase-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md transition-colors duration-200">Generate Passphrase</button>
       </div>
    
       <div id="section-captcha-practice" class="tab-content hidden">
           <h2 id="captcha-instruction" class="text-lg font-bold text-gray-800 mb-4 text-center"></h2>
           <div id="captcha-grid" class="captcha-grid mb-6">
               </div>
           <button id="verify-captcha-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md transition-colors duration-200">Verify</button>
           <p id="captcha-message" class="text-center font-semibold mt-4"></p>
       </div>


       <div class="mt-8 pt-4 border-t border-gray-200">
           <div class="flex justify-between items-center mb-4">
               <h2 class="text-lg font-bold text-gray-800">Recent History</h2>
               <button id="clear-history-btn" class="text-sm text-red-500 hover:text-red-700 transition-colors duration-200">Clear History</button>
           </div>
           <ul id="history-list" class="space-y-2">
               <li class="text-gray-500 text-sm">No history yet.</li>
           </ul>
       </div>
    
       <div class="mt-8 p-4 bg-yellow-100 rounded-xl border-l-4 border-yellow-500 text-yellow-800">
           <p class="font-bold">Important Security Tip:</p>
           <p class="text-sm mt-2">The best way to protect your accounts is to enable **Multi-Factor Authentication (MFA)**. This adds a second layer of security, like a code from your phone, to prevent unauthorized access even if your password ismen is stolen.</p>
       </div>


       <div id="message-box" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
           <div class="bg-white p-6 rounded-lg shadow-xl text-center">
               <p id="message-text" class="text-gray-800 font-semibold mb-4"></p>
               <button id="close-message" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">OK</button>
           </div>
       </div>
   </div>


   <script>
       document.addEventListener('DOMContentLoaded', () => {
           const lengthSlider = document.getElementById('length-slider');
           const lengthValue = document.getElementById('length-value');
           const passwordOutput = document.getElementById('password-output');
           const generateBtn = document.getElementById('generate-btn');
           const copyBtnPassword = document.getElementById('copy-btn-password');
           const customCharSetInput = document.getElementById('custom-char-set');
           const excludeAmbiguousCheckbox = document.getElementById('exclude-ambiguous');


           const strengthBar = document.getElementById('strength-bar');
           const strengthText = document.getElementById('strength-text');
           const entropyDisplay = document.getElementById('entropy-display');
           const testPasswordInput = document.getElementById('test-password-input');
           const strengthTipsList = document.getElementById('tips-list');
           const crackTimeDisplay = document.getElementById('crack-time-display');
           const pwnedStatus = document.getElementById('pwned-status');


           const passphraseOutput = document.getElementById('passphrase-output');
           const passphraseLengthSlider = document.getElementById('passphrase-length-slider');
           const passphraseLengthValue = document.getElementById('passphrase-length-value');
           const passphraseSeparator = document.getElementById('passphrase-separator');
           const capitalizeWords = document.getElementById('capitalize-words');
           const generatePassphraseBtn = document.getElementById('generate-passphrase-btn');
           const copyBtnPassphrase = document.getElementById('copy-btn-passphrase');
           const useCustomWordsCheckbox = document.getElementById('use-custom-words');
           const customWordInput = document.getElementById('custom-word-input');


           const captchaCornerBtn = document.getElementById('captcha-corner-btn');
           const captchaInstruction = document.getElementById('captcha-instruction');
           const captchaGrid = document.getElementById('captcha-grid');
           const verifyCaptchaBtn = document.getElementById('verify-captcha-btn');
           const captchaMessage = document.getElementById('captcha-message');


           const historyList = document.getElementById('history-list');
           const clearHistoryBtn = document.getElementById('clear-history-btn');


           const tabs = {
               'tab-generate-password': 'section-generate-password',
               'tab-test-password': 'section-test-password',
               'tab-generate-passphrase': 'section-generate-passphrase',
               'captcha-corner-btn': 'section-captcha-practice'
           };


           const messageBox = document.getElementById('message-box');
           const messageText = document.getElementById('message-text');
           const closeMessageBtn = document.getElementById('close-message');


           const ambiguous = 'l1IO0';
           const defaultWords = [
               "apple", "banana", "cat", "dog", "elephant", "fish", "guitar", "house", "ice", "jungle",
               "kite", "lemon", "mountain", "notebook", "ocean", "pizza", "queen", "robot", "sunshine", "tree",
               "umbrella", "violin", "whale", "xray", "yellow", "zebra", "happy", "brave", "quiet", "strong", "manzana",
               "pollo", "extrana", "cuarenta", "fria", "phoenix", "colgate", "french", "fry", "galaxy"
           ];
          
           const CAPTCHA_EMOJIS = ['🐶', '🐱', '🐭', '🐹', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯', '🦁', '🐮', '🐷', '🐸', '🐵', '🐔', '🐧', '🐦', '🦉'];
           //
           let currentCaptchaChallenge = { emoji: null, correctTiles: [] };


           const HISTORY_MAX_SIZE = 5;


           const showMessage = (text) => {
               messageText.textContent = text;
               messageBox.classList.remove('hidden');
           };


           closeMessageBtn.addEventListener('click', () => {
               messageBox.classList.add('hidden');
           });


           const getHistory = () => {
               try {
                   const history = JSON.parse(localStorage.getItem('passwordHistory')) || [];
                   return history;
               } catch (e) {
                   console.error("Could not load history from localStorage:", e);
                   return [];
               }
           };


           const saveToHistory = (entry) => {
               let history = getHistory();
               history.unshift(entry);
               if (history.length > HISTORY_MAX_SIZE) {
                   history = history.slice(0, HISTORY_MAX_SIZE);
               }
               localStorage.setItem('passwordHistory', JSON.stringify(history));
               displayHistory();
           };


           const clearHistory = () => {
               localStorage.removeItem('passwordHistory');
               displayHistory();
           };


           const displayHistory = () => {
               const history = getHistory();
               historyList.innerHTML = '';
               if (history.length === 0) {
                   historyList.innerHTML = '<li class="text-gray-500 text-sm">No history yet.</li>';
                   return;
               }


               history.forEach(item => {
                   const li = document.createElement('li');
                   li.classList.add('flex', 'justify-between', 'items-center', 'py-1', 'px-2', 'bg-gray-100', 'rounded-lg');
                  
                   const span = document.createElement('span');
                   span.classList.add('font-mono', 'text-gray-700', 'text-sm', 'truncate', 'cursor-pointer');
                   span.textContent = item;
                   span.title = item;
                  
                   const copyBtn = document.createElement('button');
                   copyBtn.classList.add('ml-2', 'text-gray-500', 'hover:text-blue-600');
                   copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 4l3 3m0 0l-3 3m3-3h8a2 2 0 002-2v-2m-3-1l3 3m0 0l-3 3"/></svg>';
                   copyBtn.addEventListener('click', () => {
                       navigator.clipboard.writeText(item).then(() => {
                           showMessage('Copied to clipboard!');
                       }).catch(err => {
                           console.error('Failed to copy text:', err);
                           showMessage('Failed to copy. Please try again.');
                       });
                   });


                   li.appendChild(span);
                   li.appendChild(copyBtn);
                   historyList.appendChild(li);
               });
           };


           clearHistoryBtn.addEventListener('click', clearHistory);
          
           document.querySelectorAll('button[id^="tab-"], button#captcha-corner-btn').forEach(tab => {
               tab.addEventListener('click', () => {
                   document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
                   document.querySelectorAll('button[id^="tab-"]').forEach(t => t.classList.remove('border-blue-600'));
                  
                   const sectionId = tabs[tab.id];
                   document.getElementById(sectionId).classList.remove('hidden');
                  
                   if (tab.id.startsWith('tab-')) {
                       tab.classList.add('border-blue-600');
                   }


                   if (sectionId === 'section-captcha-practice') {
                       generateCaptcha();
                   } else {
                       updateStrength('');
                   }
               });
           });


           lengthSlider.addEventListener('input', () => {
               lengthValue.textContent = lengthSlider.value;
           });


           lengthSlider.addEventListener('change', generatePassword);
           customCharSetInput.addEventListener('input', generatePassword);
           excludeAmbiguousCheckbox.addEventListener('change', generatePassword);


           generateBtn.addEventListener('click', () => {
               const newPassword = generatePassword();
               saveToHistory(newPassword);
           });
          
           copyBtnPassword.addEventListener('click', () => {
               if (passwordOutput.value && passwordOutput.value !== "Click 'Generate'") {
                   navigator.clipboard.writeText(passwordOutput.value).then(() => {
                       showMessage('Password copied to clipboard!');
                   }).catch(err => {
                       console.error('Failed to copy text:', err);
                       showMessage('Failed to copy. Please try again.');
                   });
               } else {
                   showMessage('No password to copy.');
               }
           });


           function generatePassword() {
               const length = lengthSlider.value;
               let characterSet = customCharSetInput.value.trim();


               if (characterSet.length === 0) {
                   characterSet = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:",./<>?`~';
                   customCharSetInput.value = characterSet;
               }
              
               if (excludeAmbiguousCheckbox.checked) {
                   characterSet = characterSet.split('').filter(char => !ambiguous.includes(char)).join('');
               }


               if (characterSet.length === 0) {
                   passwordOutput.value = '';
                   updateStrength('');
                   return '';
               }


               let password = '';
               for (let i = 0; i < length; i++) {
                   const randomIndex = Math.floor(Math.random() * characterSet.length);
                   password += characterSet[randomIndex];
               }
               passwordOutput.value = password;
               updateStrength(password);
               return password;
           }


           testPasswordInput.addEventListener('input', () => {
               const password = testPasswordInput.value;
               updateStrength(password);
               displayStrengthTips(password);
               checkPwnedPassword(password);
           });


           passphraseLengthSlider.addEventListener('input', () => {
               passphraseLengthValue.textContent = passphraseLengthSlider.value;
           });


           useCustomWordsCheckbox.addEventListener('change', () => {
               customWordInput.disabled = !useCustomWordsCheckbox.checked;
               if (useCustomWordsCheckbox.checked) {
                   customWordInput.focus();
               }
           });


           [passphraseLengthSlider, passphraseSeparator, capitalizeWords, useCustomWordsCheckbox, customWordInput].forEach(elem => {
               elem.addEventListener('input', () => {
                   generatePassphrase();
               });
           });
          
           generatePassphraseBtn.addEventListener('click', () => {
               const newPassphrase = generatePassphrase();
               saveToHistory(newPassphrase);
           });


           copyBtnPassphrase.addEventListener('click', () => {
               if (passphraseOutput.value && passphraseOutput.value !== "Click 'Generate'") {
                   navigator.clipboard.writeText(passphraseOutput.value).then(() => {
                       showMessage('Passphrase copied to clipboard!');
                   }).catch(err => {
                       console.error('Failed to copy text:', err);
                       showMessage('Failed to copy. Please try again.');
                   });
               } else {
                   showMessage('No passphrase to copy.');
               }
           });
          
           function generatePassphrase() {
               const numWords = passphraseLengthSlider.value;
               const separator = passphraseSeparator.value;
               const shouldCapitalize = capitalizeWords.checked;


               let wordList;
               if (useCustomWordsCheckbox.checked) {
                   const customWords = customWordInput.value.split(/[\s,]+/).filter(word => word.length > 0);
                   if (customWords.length === 0) {
                       showMessage('Please enter at least one custom word.');
                       passphraseOutput.value = '';
                       return '';
                   }
                   wordList = customWords;
               } else {
                   wordList = defaultWords;
               }


               let passphrase = [];
               for (let i = 0; i < numWords; i++) {
                   const randomIndex = Math.floor(Math.random() * wordList.length);
                   let word = wordList[randomIndex];
                   if (shouldCapitalize) {
                       word = word.charAt(0).toUpperCase() + word.slice(1);
                   }
                   passphrase.push(word);
               }
               const result = passphrase.join(separator);
               passphraseOutput.value = result;
               updateStrength(result);
               return result;
           }


           function updateStrength(password) {
               if (password === '') {
                   strengthBar.style.width = '0%';
                   strengthBar.style.backgroundColor = 'transparent';
                   strengthText.textContent = '--';
                   entropyDisplay.textContent = '--';
                   crackTimeDisplay.textContent = 'Calculating...';
                   return;
               }
              
               let entropy;
               const activeTabId = document.querySelector('.tab-content:not(.hidden)').id;
               const isPassphrase = activeTabId === 'section-generate-passphrase' || testPasswordInput.value.includes(' ');
              
               if (isPassphrase) {
                   const words = password.split(/[\s_-]/).filter(w => w.length > 0);
                   const wordListSize = useCustomWordsCheckbox.checked ? customWordInput.value.split(/[\s,]+/).filter(w => w.length > 0).length : defaultWords.length;
                   if (words.length === 0 || wordListSize === 0) {
                       entropy = 0;
                   } else {
                       entropy = words.length * Math.log2(wordListSize);
                   }
               } else {
                   const charPoolSize = getCharacterSetSize(password);
                   entropy = calculateEntropy(charPoolSize, password.length);
               }
              
               entropyDisplay.textContent = `${entropy.toFixed(2)} bits`;


               let strength = '';
               let color = '';
               let width = 0;


               if (entropy > 128) {
                   strength = 'Very Strong';
                   color = '#22c55e';
                   width = 100;
               } else if (entropy > 80) {
                   strength = 'Strong';
                   color = '#84cc16';
                   width = 80;
               } else if (entropy > 60) {
                   strength = 'Medium';
                   color = '#eab308';
                   width = 60;
               } else if (entropy > 40) {
                   strength = 'Weak';
                   color = '#f97316';
                   width = 40;
               } else {
                   strength = 'Very Weak';
                   color = '#ef4444';
                   width = 20;
               }


               strengthBar.style.width = width + '%';
               strengthBar.style.backgroundColor = color;
               strengthText.textContent = strength;
              
               calculateCrackTime(password, isPassphrase, entropy);
           }


           function calculateEntropy(poolSize, length) {
               if (poolSize === 0 || length === 0) return 0;
               return length * Math.log2(poolSize);
           }
          
           function calculateCrackTime(password, isPassphrase, entropy) {
               // Using a more realistic (and variable) guesses per second
               const guessesPerSecond = 100000000000;
               const secondsToCrack = Math.pow(2, entropy) / guessesPerSecond;
              
               crackTimeDisplay.textContent = formatTime(secondsToCrack);
           }


           function getCharacterSetSize(password) {
               let size = 0;
               if (/[A-Z]/.test(password)) size += 26;
               if (/[a-z]/.test(password)) size += 26;
               if (/[0-9]/.test(password)) size += 10;
               if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(password)) size += 32;
               return size;
           }


           function formatTime(seconds) {
               if (seconds < 1) return `Less than 1 second`;
               if (seconds < 60) return `${Math.round(seconds)} seconds`;
               const minutes = seconds / 60;
               if (minutes < 60) return `${Math.round(minutes)} minutes`;
               const hours = minutes / 60;
               if (hours < 24) return `${Math.round(hours)} hours`;
               const days = hours / 24;
               if (days < 365) return `${Math.round(days)} days`;
               const years = days / 365.25;
               if (years < 1000) return `${years.toFixed(1)} years`;
               return 'Over 1000 years';
           }


           function displayStrengthTips(password) {
               strengthTipsList.innerHTML = '';
               const tips = [];
               const hasUppercase = /[A-Z]/.test(password);
               const hasLowercase = /[a-z]/.test(password);
               const hasNumbers = /[0-9]/.test(password);
               const hasSymbols = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(password);
               const isPassphrase = password.includes(' ');


               if (password.length < 12) {
                   tips.push('Increase password length. Longer passwords are much harder to crack.');
               }
               if (!hasUppercase) {
                   tips.push('Include uppercase letters (A-Z) for more complexity.');
               }
               if (!hasLowercase) {
                   tips.push('Include lowercase letters (a-z) for more complexity.');
               }
               if (!hasNumbers) {
                   tips.push('Add numbers (0-9) to your password.');
               }
               if (!hasSymbols) {
                   tips.push('Add special characters or symbols (!, @, #, etc.).');
               }
               if (isPassphrase && password.length > 20) {
                   tips.push('Passphrases are a great way to create a strong, memorable password.');
               }
              
               if (tips.length === 0) {
                   tips.push('Looks great! Your password is strong and secure.');
               }


               tips.forEach(tip => {
                   const li = document.createElement('li');
                   li.textContent = '➡️ ' + tip;
                   strengthTipsList.appendChild(li);
               });
           }


           // Mocking the Pwned Passwords API check
           async function checkPwnedPassword(password) {
               if (password.length === 0) {
                   pwnedStatus.textContent = 'Enter a password to check';
                   pwnedStatus.className = 'text-center font-semibold p-2 rounded-lg';
                   return;
               }
              
               pwnedStatus.textContent = 'Checking...';
               pwnedStatus.className = 'text-center font-semibold p-2 rounded-lg text-gray-700 bg-gray-200';
              
               // This is a mock response, a real implementation would use a service like Have I Been Pwned API
               const pwnedPasswords = ['password123', '123456', 'qwerty', 'admin'];
               await new Promise(r => setTimeout(r, 1000)); // Simulate API delay
              
               const isPwned = pwnedPasswords.includes(password.toLowerCase());


               if (isPwned) {
                   pwnedStatus.textContent = '⚠️ Oh no! This password has been found in a data breach. DO NOT USE IT.';
                   pwnedStatus.className = 'text-center font-semibold p-2 rounded-lg text-white bg-red-500';
               } else {
                   pwnedStatus.textContent = '✅ Great! Your password was not found in a public data breach.';
                   pwnedStatus.className = 'text-center font-semibold p-2 rounded-lg text-white bg-green-500';
               }
           }


           // CAPTCHA functionality
           function generateCaptcha() {
               captchaGrid.innerHTML = '';
               captchaMessage.textContent = '';
               const challengeEmoji = CAPTCHA_EMOJIS[Math.floor(Math.random() * CAPTCHA_EMOJIS.length)];
               captchaInstruction.textContent = `Select all tiles containing the ${challengeEmoji} emoji.`;


               const allEmojis = [...CAPTCHA_EMOJIS];
               const gridEmojis = [];
               for (let i = 0; i < 9; i++) {
                   const randomEmoji = allEmojis[Math.floor(Math.random() * allEmojis.length)];
                   gridEmojis.push(randomEmoji);
               }


               currentCaptchaChallenge.emoji = challengeEmoji;
               currentCaptchaChallenge.correctTiles = [];


               gridEmojis.forEach((emoji, index) => {
                   const tile = document.createElement('div');
                   tile.classList.add('captcha-tile');
                   tile.textContent = emoji;
                   tile.dataset.index = index;
                   if (emoji === challengeEmoji) {
                       currentCaptchaChallenge.correctTiles.push(index);
                   }
                   tile.addEventListener('click', () => {
                       tile.classList.toggle('selected');
                   });
                   captchaGrid.appendChild(tile);
               });
           }


           verifyCaptchaBtn.addEventListener('click', () => {
               const selectedTiles = document.querySelectorAll('.captcha-tile.selected');
               const selectedIndices = Array.from(selectedTiles).map(tile => parseInt(tile.dataset.index));
              
               const isCorrect = selectedIndices.length === currentCaptchaChallenge.correctTiles.length &&
                                 selectedIndices.every(index => currentCaptchaChallenge.correctTiles.includes(index));


               if (isCorrect) {
                   captchaMessage.textContent = 'Verification successful';
                   captchaMessage.className = 'text-center font-semibold mt-4 text-green-600';
               } else {
                   captchaMessage.textContent = 'Verification failed. Please try again';
                   captchaMessage.className = 'text-center font-semibold mt-4 text-red-600';
                   generateCaptcha();
               }
           });


           // Initialize on page load
           displayHistory();
           document.getElementById('tab-generate-password').click();
       });
   </script>
</body>

</html>
